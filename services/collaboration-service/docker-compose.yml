services:
  # ----------------------------------------------------------------------
  # Production Service (Profile: prod)
  # ----------------------------------------------------------------------
  collaboration-service-prod:
    # Only runs when the 'prod' profile is explicitly active
    profiles: ["prod"]
    build:
      context: .
      dockerfile: Dockerfile
    image: collaboration-service:latest
    container_name: collaboration-service-prod
    ports:
      - "8000:8000"
    environment:
      - COLLAB_CORS_ORIGINS=${COLLAB_CORS_ORIGINS}
      - CODE_EXEC_SERVICE_URL=${CODE_EXEC_SERVICE_URL}
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000

  # ----------------------------------------------------------------------
  # Development Service (Profile: dev)
  # ----------------------------------------------------------------------
  collaboration-service-dev:
    # Only runs when the 'dev' profile is explicitly active
    profiles: ["dev"]
    build:
      context: .
      dockerfile: Dockerfile
    container_name: collaboration-service-dev
    ports:
      - "8000:8000"
    environment:
      - COLLAB_CORS_ORIGINS=${COLLAB_CORS_ORIGINS}
      - CODE_EXEC_SERVICE_URL=${CODE_EXEC_SERVICE_URL}
    volumes:
      - .:/app

    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

  # ----------------------------------------------------------------------
  # Yjs WebSocket Server (Shared - No Profile)
  #    This service runs in both dev and prod environments by default.
  # ----------------------------------------------------------------------


